<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Landform Assembly Line: Constructive vs. Destructive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            width: 100%;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .assembly-line {
            display: grid;
            gap: 20px;
            min-height: 400px;
            width: 100%;
        }
        /* Grid definitions based on mode */
        .grid-2 { grid-template-columns: 1fr 1fr; }
        .grid-3 { grid-template-columns: repeat(3, 1fr); }

        .drop-zone {
            padding: 20px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: background-color 0.3s, border-color 0.3s, box-shadow 0.3s;
            border: 4px dashed #9ca3af;
        }
        .constructive {
            background-color: #d1fae5; border-color: #10b981;
        }
        .destructive {
            background-color: #fee2e2; border-color: #ef4444;
        }
        /* Specific Drop Zone Colors for Level 3 */
        .mechanical { background-color: #fffbeb; border-color: #f59e0b; }
        .chemical { background-color: #e0f2fe; border-color: #3b82f6; }
        .erosion-zone { background-color: #f0f4f8; border-color: #059669; }

        .drop-zone.hover {
            border-style: solid;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }
        .drop-zone h2 {
            font-size: 1.5rem; /* Slightly smaller for 3 columns */
            font-weight: 700;
            margin-bottom: 15px;
        }
        .card-area {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            min-height: 150px;
            width: 100%;
        }
        .landform-card {
            cursor: grab;
            width: 180px;
            padding: 15px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            text-align: center;
        }
        .landform-card:active {
            cursor: grabbing;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
            transform: scale(1.05) rotate(1deg);
        }
        /* ... Modal and Cheatsheet styles remain the same ... */

        /* NEW Landform Card Icon Styling */
        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 5px;
            line-height: 1;
            display: block;
        }
        .mode-toggle-btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .mode-default { background-color: #60a5fa; color: white; }
        .mode-deep { background-color: #f97316; color: white; }
        .mode-ultimate { background-color: #8b5cf6; color: white; }


        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .assembly-line {
                grid-template-columns: 1fr; /* Single column layout on mobile */
                gap: 15px;
            }
        }
    </style>
</head>
<body class="bg-gray-50">

<div class="container">
    <div class="header">
        <h1 class="text-4xl font-extrabold text-blue-700">Landform Assembly Line</h1>
        <p class="text-xl text-gray-600 mt-2">Sort the Landform Cards into the correct station.</p>
        <div class="flex justify-center items-center mt-4 flex-wrap gap-4">
            <div class="score-bar" id="score-bar">Score: 0 / 0</div>
            <button class="px-4 py-2 bg-yellow-500 text-white font-semibold rounded-lg hover:bg-yellow-600 transition" onclick="showCheatsheet()">
                Reference Cheatsheet üìö
            </button>
            <button id="mode-toggle" class="mode-toggle-btn mode-default" onclick="toggleGameMode()">
                Switch Mode
            </button>
        </div>
    </div>

    <!-- Assembly Line Container (Structure changes dynamically based on mode) -->
    <div class="assembly-line" id="assembly-line-container">
        <!-- Drop zones are injected here by JavaScript based on currentMode -->
    </div>

    <!-- Incoming Card Stack -->
    <div class="mt-8 p-6 bg-white rounded-lg shadow-xl w-full max-w-lg text-center">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Incoming Card: <span id="mode-label" class="text-blue-500 text-base">(Level 1: Landform Mode)</span></h2>
        <div id="current-card-container" class="flex justify-center">
            <!-- Current card will be placed here -->
        </div>
        <button id="start-btn" class="mt-4 px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition" onclick="startGame()">Start Game</button>
    </div>

</div>

<!-- Feedback Modal -->
<div id="feedback-modal">
    <div id="modal-content" class="modal-content relative">
        <span class="close-btn" onclick="hideFeedback()">&times;</span>
        <h3 class="text-2xl font-bold mb-3" id="feedback-title"></h3>
        
        <span id="feedback-icon-display" class="block"></span>

        <p class="text-lg mb-4 text-center" id="feedback-message"></p>
        
        <div id="feedback-concept"></div>

        <button class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg" onclick="hideFeedback()">Continue</button>
    </div>
</div>

<!-- Cheatsheet Modal (Cheatsheet table remains the same, updated by JS) -->
<div id="cheatsheet-modal" onclick="hideCheatsheet(event)">
    <div id="cheatsheet-content" onclick="event.stopPropagation()">
        <span class="close-btn" onclick="hideCheatsheet()">&times;</span>
        <h3 class="text-2xl font-bold text-gray-800 mb-4">üìö Landform Formation Cheatsheet</h3>
        <p class="text-gray-600">Reference the Landform Type and the **Visual Process Icon** before dropping your card. **Destructive Sub-Types** are listed in the far right column.</p>
        
        <h4 class="text-xl font-bold text-green-700 mt-6 mb-2">üõ†Ô∏è Constructive Processes (BUILD UP)</h4>
        <table id="cheatsheet-table">
            <thead>
                <tr>
                    <th>Landform/Process</th>
                    <th>Icon</th>
                    <th>Type</th>
                    <th>Process Icon</th>
                    <th>Destructive Sub-Type</th>
                    <th>Key Rule / Action</th>
                </tr>
            </thead>
            <tbody id="constructive-rows"></tbody>
        </table>
        
        <h4 class="text-xl font-bold text-red-700 mt-6 mb-2">üí• Destructive Processes (TEAR DOWN)</h4>
        <table id="cheatsheet-table-destructive">
             <thead>
                <tr>
                    <th>Landform/Process</th>
                    <th>Icon</th>
                    <th>Type</th>
                    <th>Process Icon</th>
                    <th>Destructive Sub-Type</th>
                    <th>Key Rule / Action</th>
                </tr>
            </thead>
            <tbody id="destructive-rows"></tbody>
        </table>
        
        <button class="mt-6 px-4 py-2 bg-blue-600 text-white rounded-lg" onclick="hideCheatsheet()">Close Cheatsheet</button>
    </div>
</div>


<script>
    // Landforms Data with new properties for the Ultimate Challenge (Level 3)
    const landformsData = [
        // Destructive Landforms
        { name: "Arete", icon: "‚õ∞Ô∏è", type: "Destructive", destructiveSubType: "Erosion", isDeepDive: false, description: "A sharp, narrow ridge formed between two glacial valleys.", concept: "Glaciers erode and **move** the rock on both sides. This is **Erosion** because material is carried away.", processIcon: "üßäüî™ Glacial Erosion" },
        { name: "V-Shaped Valley", icon: "üîΩ", type: "Destructive", destructiveSubType: "Erosion", isDeepDive: false, description: "A valley carved with a narrow bottom by a river.", concept: "River water **cuts down and carries away** material (erosion), creating the V-shape.", processIcon: "üåäüîΩ Water Carving" },
        { name: "Sea Arch / Sea Stack", icon: "üèùÔ∏è", type: "Destructive", destructiveSubType: "Erosion", isDeepDive: false, description: "Pillars of rock separated from the headland.", concept: "Waves erode and **remove** material from the headland. This is **Erosion**.", processIcon: "üí•üåä Wave Breaking" },
        { name: "Kettle", icon: "üíß", type: "Destructive", destructiveSubType: "Erosion", isDeepDive: false, description: "A small pond or lake resembling a crater.", concept: "The melting of dead ice results in the **removal of support and collapse**, which is classified as an erosional event.", processIcon: "üï≥Ô∏è‚¨áÔ∏è Ice Collapse" },

        // Destructive Processes (Deep Dive)
        { name: "Freeze-Thaw", icon: "ü•∂üî®", type: "Destructive", destructiveSubType: "Mechanical Weathering", isDeepDive: true, description: "The physical breaking of rock as frozen water expands in cracks.", concept: "This is **Mechanical Weathering** because the rock is broken **physically** without changing its chemical composition. It stays in place.", processIcon: "üî®üíî Mechanical Weathering" },
        { name: "Root Wedging", icon: "üå≥üî®", type: "Destructive", destructiveSubType: "Mechanical Weathering", isDeepDive: true, description: "Plant roots break rocks apart through physical pressure.", concept: "This is also **Mechanical Weathering**. The force of the root is **physical**, breaking the rock apart (in place).", processIcon: "üå≥üî® Mechanical Weathering" },
        { name: "Oxidation", icon: "üß™üé®", type: "Destructive", destructiveSubType: "Chemical Weathering", isDeepDive: true, description: "Rock minerals react with oxygen, causing a change in composition (like rust).", concept: "This is **Chemical Weathering**. The rock's **substance changes** at a molecular level (in place).", processIcon: "‚öõÔ∏èüîÑ Chemical Weathering" },
        { name: "Glaciation (as force)", icon: "üèîÔ∏èüßä", type: "Destructive", destructiveSubType: "Erosion", isDeepDive: true, description: "The powerful movement of large masses of ice, scraping and carrying the landscape.", concept: "This is primarily **Erosion**. It's defined by the ice **moving** and transporting sediment over long distances.", processIcon: "üßä‚û°Ô∏è Erosion Force" },

        // Constructive Landforms/Processes
        { name: "Esker", icon: "„Ä∞Ô∏è", type: "Constructive", destructiveSubType: null, isDeepDive: false, description: "A long, winding ridge of material left by a melting glacier.", concept: "Rivers *inside* the glacier **deposit** rocks and debris, **adding** land mass. This is **Sediment Deposition**.", processIcon: "‚¨ÜÔ∏è‚õ∞Ô∏è Sediment Ridge" },
        { name: "Moraine", icon: "üöß", type: "Constructive", destructiveSubType: null, isDeepDive: false, description: "A ridge of scraped dirt and rocks pushed by a glacier.", concept: "A glacier **pushes up and deposits** material, **adding** land mass. This is **Addition** of land mass.", processIcon: "üß±üí™ Glacial Push" },
        { name: "Coastline", icon: "üèñÔ∏è", type: "Constructive", destructiveSubType: null, isDeepDive: false, description: "The edge of the land often formed by sediment deposit.", concept: "Often involves **Sediment Deposition** (sand bars) that **build up** the land's edge.", processIcon: "üèñÔ∏è‚ûï Land Addition" },
        { name: "Fold Mountain", icon: "üìà", type: "Constructive", destructiveSubType: null, isDeepDive: true, description: "Mountains formed by the upward folding of the Earth's crust.", concept: "This is **Crustal Deformation**, a powerful geological process that **pushes up and builds** land features.", processIcon: "‚è´üóúÔ∏è Crustal Uplift" }
    ];

    const modeConfigurations = [
        { name: "Landform Mode", level: 1, class: "mode-default", cards: landformsData.filter(lf => !lf.isDeepDive), targetTypes: ['Constructive', 'Destructive'], gridClass: 'grid-2' },
        { name: "Deep Dive Mode", level: 2, class: "mode-deep", cards: landformsData, targetTypes: ['Constructive', 'Destructive'], gridClass: 'grid-2' },
        { name: "Ultimate Challenge", level: 3, class: "mode-ultimate", cards: landformsData.filter(lf => lf.type === 'Destructive'), targetTypes: ['Mechanical Weathering', 'Chemical Weathering', 'Erosion'], gridClass: 'grid-3' }
    ];

    let currentMode = 0; // 0, 1, or 2
    let currentLandform = null;
    let landformsQueue = [];
    let score = 0;
    let totalCards = 0;

    const assemblyLineContainer = document.getElementById('assembly-line-container');
    const currentCardContainer = document.getElementById('current-card-container');
    const feedbackModal = document.getElementById('feedback-modal');
    const cheatsheetModal = document.getElementById('cheatsheet-modal');
    const modalContent = document.getElementById('modal-content');
    const startButton = document.getElementById('start-btn');
    const scoreBar = document.getElementById('score-bar');
    const feedbackIconDisplay = document.getElementById('feedback-icon-display');
    const modeToggleButton = document.getElementById('mode-toggle');
    const modeLabel = document.getElementById('mode-label');


    // --- Mode Management ---

    function toggleGameMode() {
        currentMode = (currentMode + 1) % modeConfigurations.length;
        renderDropZones();
        startGame(); // Restart game in the new mode
    }

    function renderDropZones() {
        const config = modeConfigurations[currentMode];
        assemblyLineContainer.innerHTML = '';
        assemblyLineContainer.className = `assembly-line ${config.gridClass}`;
        
        modeToggleButton.className = `mode-toggle-btn ${config.class}`;
        modeToggleButton.textContent = `Switch Mode (Level ${((currentMode + 1) % modeConfigurations.length) + 1})`;
        
        modeLabel.textContent = `(Level ${config.level}: ${config.name})`;
        modeLabel.className = `text-base ${config.class.replace('mode', 'text')}-500`;

        const dropZoneDefs = [
            { id: 'constructive-zone', type: 'Constructive', title: 'Constructive (Build Up)', emoji: '‚ûï', colorClass: 'constructive', description: 'Addition of land, deposition.' },
            { id: 'destructive-zone', type: 'Destructive', title: 'Destructive (Tear Down)', emoji: '‚ûñ', colorClass: 'destructive', description: 'Weathering, erosion, breaking down.' },
            { id: 'mechanical-zone', type: 'Mechanical Weathering', title: 'Mechanical Weathering', emoji: 'üî®', colorClass: 'mechanical', description: 'Physical break down (in place).' },
            { id: 'chemical-zone', type: 'Chemical Weathering', title: 'Chemical Weathering', emoji: 'üß™', colorClass: 'chemical', description: 'Chemical change of substance (in place).' },
            { id: 'erosion-zone', type: 'Erosion', title: 'Erosion (Movement)', emoji: 'üí®', colorClass: 'erosion-zone', description: 'Breaking down AND carrying material away.' }
        ];

        let zonesToRender = [];
        if (config.level < 3) {
            zonesToRender = dropZoneDefs.filter(z => config.targetTypes.includes(z.type));
        } else { // Level 3: Ultimate Challenge
            zonesToRender = dropZoneDefs.slice(2, 5); // Mechanical, Chemical, Erosion
        }
        
        zonesToRender.forEach(def => {
            const zone = document.createElement('div');
            zone.id = def.id;
            zone.setAttribute('data-type', def.type);
            zone.className = `drop-zone ${def.colorClass}`;
            zone.innerHTML = `
                <h2 class="flex items-center">
                    <span class="text-2xl mr-2">${def.emoji}</span>
                    ${def.title}
                </h2>
                <p class="text-gray-600 mb-4 text-center text-sm">${def.description}</p>
                <div id="${def.id}-cards" class="card-area"></div>
            `;
            
            zone.addEventListener('dragover', allowDrop);
            zone.addEventListener('dragleave', removeHover);
            zone.addEventListener('drop', drop);
            assemblyLineContainer.appendChild(zone);
        });
    }

    // --- Drag and Drop Logic (simplified for brevity) ---

    function allowDrop(event) {
        event.preventDefault();
        event.currentTarget.classList.add('hover');
    }

    function removeHover(event) {
        event.currentTarget.classList.remove('hover');
    }

    function drag(event, data) {
        event.dataTransfer.setData("application/json", JSON.stringify(data));
        event.currentTarget.classList.add('opacity-50');
    }

    function drop(event) {
        event.preventDefault();
        removeHover(event);
        const droppedData = JSON.parse(event.dataTransfer.getData("application/json"));
        const targetType = event.currentTarget.getAttribute('data-type');
        
        checkClassification(droppedData, targetType, event.currentTarget);
    }

    // --- Game Logic ---

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function startGame() {
        startButton.style.display = 'none';
        
        const config = modeConfigurations[currentMode];
        let filteredData = config.cards;

        shuffleArray(filteredData);
        landformsQueue = [...filteredData];
        score = 0;
        totalCards = 0;
        
        // Clear previous cards from all possible zones
        document.querySelectorAll('.card-area').forEach(el => el.innerHTML = '');

        updateScoreBar();
        loadNextCard();
    }

    function loadNextCard() {
        currentCardContainer.innerHTML = '';
        currentLandform = null;

        if (landformsQueue.length === 0) {
            showFinalScore();
            return;
        }

        currentLandform = landformsQueue.shift();
        totalCards++;

        const card = document.createElement('div');
        card.className = 'landform-card';
        card.setAttribute('draggable', true);
        card.setAttribute('id', 'current-drag-card');
        card.addEventListener('dragstart', (e) => drag(e, currentLandform));
        card.addEventListener('dragend', (e) => e.currentTarget.classList.remove('opacity-50'));
        
        card.innerHTML = `
            <span class="card-icon">${currentLandform.icon}</span>
            <h3 class="text-lg">${currentLandform.name}</h3>
            <p>${currentLandform.description}</p>
        `;

        currentCardContainer.appendChild(card);
    }

    function checkClassification(cardData, targetType, dropZone) {
        const config = modeConfigurations[currentMode];
        let isCorrect = false;
        let cardTarget;

        if (config.level < 3) {
            // Level 1 & 2: Target is the main 'type'
            cardTarget = cardData.type;
            isCorrect = cardTarget === targetType;
        } else {
            // Level 3: Target is the 'destructiveSubType'
            cardTarget = cardData.destructiveSubType;
            isCorrect = cardTarget === targetType;
        }

        showFeedback(isCorrect, cardData, cardTarget, targetType);

        // Move card visually (simplified implementation)
        const cardElement = document.getElementById('current-drag-card');
        if (cardElement) {
            cardElement.remove();
            
            // Create a permanent card
            const permanentCard = document.createElement('div');
            permanentCard.className = `landform-card ${isCorrect ? 'bg-green-100 border-2 border-green-500' : 'bg-red-100 border-2 border-red-500'} cursor-default`;
            permanentCard.style.width = '160px'; 
            permanentCard.innerHTML = `
                <span class="card-icon" style="font-size: 1.5rem;">${cardData.icon}</span>
                <h3 class="text-base">${cardData.name}</h3>
                <p class="text-xs">${cardTarget}</p>
            `;
            
            document.getElementById(dropZone.id + '-cards').appendChild(permanentCard);

        }

        if (isCorrect) {
            score++;
        }
        
        updateScoreBar();
        setTimeout(loadNextCard, 50); 
    }

    function showFeedback(isCorrect, cardData, actualType, droppedType) {
        const title = document.getElementById('feedback-title');
        const message = document.getElementById('feedback-message');
        const concept = document.getElementById('feedback-concept');

        const [iconEmoji, textExplanation] = cardData.processIcon.split(/ (.+)/);
        feedbackIconDisplay.textContent = iconEmoji;

        if (isCorrect) {
            title.textContent = "‚úÖ Correct!";
            message.innerHTML = `You correctly classified **${cardData.name}** as **${actualType}**!`;
            modalContent.className = 'modal-content correct';
        } else {
            title.textContent = "‚ùå Not Quite...";
            message.innerHTML = `You placed **${cardData.name}** in the **${droppedType}** station. It is actually **${actualType}**!`;
            modalContent.className = 'modal-content incorrect';
        }

        concept.innerHTML = `
            <p class="mt-4 text-center text-lg font-bold">Rule: ${textExplanation}</p>
            <p class="text-sm text-gray-700 italic mt-2">${cardData.concept}</p>
        `;
        
        feedbackModal.style.display = 'flex';
    }

    function hideFeedback() {
        feedbackModal.style.display = 'none';
        if (landformsQueue.length === 0 && currentCardContainer.innerHTML === '') {
            showFinalScore();
        }
    }
    
    function showFinalScore() {
        const finalMessage = `
            <h2>Quiz Complete!</h2>
            <p class="text-xl">Your Final Score: **${score} out of ${totalCards}**.</p>
            <p class="mt-4">You have mastered Level ${modeConfigurations[currentMode].level}! Review the incorrect ones above.</p>
            <button class="mt-4 px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition" onclick="window.location.reload()">Start Over</button>
        `;
        document.getElementById('current-card-container').innerHTML = finalMessage;
    }

    function updateScoreBar() {
        scoreBar.textContent = `Score: ${score} / ${totalCards}`;
    }

    // --- Cheatsheet Logic ---

    function generateCheatsheetTable() {
        const constructiveRows = document.getElementById('constructive-rows');
        const destructiveRows = document.getElementById('destructive-rows');
        constructiveRows.innerHTML = '';
        destructiveRows.innerHTML = '';

        const cheatsheetData = [...landformsData].sort((a, b) => a.name.localeCompare(b.name));

        cheatsheetData.forEach(lf => {
            const [processIconEmoji, processIconText] = lf.processIcon.split(/ (.+)/);
            
            const row = document.createElement('tr');
            row.className = lf.type === 'Constructive' ? 'constructive-row' : 'destructive-row';
            
            const deepDiveMark = lf.isDeepDive ? '<span class="text-orange-500 font-bold mr-1">üü†</span>' : '';
            const destructiveSubType = lf.destructiveSubType || 'N/A';
            const subTypeClass = lf.destructiveSubType ? `font-semibold text-sm ${lf.destructiveSubType === 'Erosion' ? 'text-green-700' : (lf.destructiveSubType.includes('Mechanical') ? 'text-yellow-700' : 'text-blue-700')}` : 'text-gray-500';

            row.innerHTML = `
                <td data-label="Landform/Process"><strong>${deepDiveMark}${lf.name}</strong></td>
                <td data-label="Icon">${lf.icon}</td>
                <td data-label="Type">${lf.type}</td>
                <td data-label="Process Icon"><strong>${processIconEmoji}</strong> ${processIconText}</td>
                <td data-label="Destructive Sub-Type" class="${subTypeClass}">${destructiveSubType}</td>
                <td data-label="Key Rule">${lf.concept.split('.').slice(0, 1).join('.')}</td>
            `;

            if (lf.type === 'Constructive') {
                constructiveRows.appendChild(row);
            } else {
                destructiveRows.appendChild(row);
            }
        });
    }

    function showCheatsheet() {
        generateCheatsheetTable();
        cheatsheetModal.style.display = 'flex';
    }

    function hideCheatsheet(event) {
        if (!event || event.target === cheatsheetModal || event.target.className.includes('close-btn') || event.target.tagName === 'BUTTON') {
            cheatsheetModal.style.display = 'none';
        }
    }


    // --- Initialization ---

    window.onload = () => {
        renderDropZones(); // Set up the default Level 1 zones
        document.getElementById('current-card-container').innerHTML = `<p class="text-gray-500">Press 'Start Game' to begin sorting landforms.</p>`;
        generateCheatsheetTable(); 
    };
</script>

</body>
</html>

